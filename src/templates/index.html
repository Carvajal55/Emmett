{% extends 'partials/base.html' %}
{% load static %}

{% block css %}
<style>

#chat-iframe {
      position: fixed; /* Posicionamiento fijo respecto a la ventana del navegador */
      right: 0;       /* Alineado a la derecha */
      bottom: 0;      /* Alineado abajo */
      width: 100%;   /* Ancho del iframe */
      height: 100%;  /* Alto del iframe */
      border: none;   /* Sin borde */
      box-shadow: -2px -2px 5px rgba(0,0,0,0.2); /* Sombra opcional para darle estilo */
      background-color: red; /* Fondo transparente */
    }

    
</style>

  <!-- Owl Carousel  -->
  <link rel="stylesheet" href="{% static 'libs/owl.carousel/dist/assets/owl.carousel.min.css' %}">


{% endblock css %}
{% block content %}
<div id="app">
  

  <div class="row d-none">
    <div class="col-lg-8 d-flex align-items-strech ">
      <div class="card w-100">
        <div class="card-body">
          <div class="d-sm-flex d-block align-items-center justify-content-between mb-9">
            <div class="mb-3 mb-sm-0">
              <h5 class="card-title fw-semibold">Mensajes del Mes</h5>
              <p class="card-subtitle mb-0">Cantidad de mensajes en los últimos dias</p>
            </div>
            <div>
              <select v-model="fecha_select" class="form-select">
                {% for x in meses %}
                <option value="{{x}}">{{x}}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="row align-items-center">
            <div class="col-lg-8 col-md-8">
              <div id="chart"></div>
            </div>
            <div class="col-lg-4 col-md-4">
              <div class="d-flex align-items-center mb-4 pb-1">
                <div class="p-8 bg-light-primary rounded-1 me-3 d-flex align-items-center justify-content-center">
                  <i class="ti ti-grid-dots text-primary fs-6"></i>
                </div>
                <div>
                  <h4 class="mb-0 fs-7 fw-semibold">[[cantidad_de_mensajes]]</h4>
                  <p class="fs-3 mb-0">Total del mes</p>
                </div>
              </div>
              <div>
                <div class="d-flex align-items-baseline mb-4">
                  <span class="round-8 bg-primary rounded-circle me-6"></span>
                  <div>
                    <p class="fs-3 mb-1">Respuestas del Bot</p>
                    <h6 class="fs-5 fw-semibold mb-0">[[cantidad_de_mensajes_text]]</h6>
                  </div>
                </div>
                <div class="d-flex align-items-baseline mb-4 pb-1">
                  <span class="round-8 bg-secondary rounded-circle me-6"></span>
                  <div>
                    <p class="fs-3 mb-1">Derivados a un Ejecutivo</p>
                    <h6 class="fs-5 fw-semibold mb-0">[[cantidad_de_mensajes_whatsapp]]</h6>
                  </div>
                </div>
                <div>
                  <button class="btn btn-primary w-100">Ver reporte completo</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="row">
        <div class="col-lg-12 col-md-6 col-sm-12">
          <!-- Yearly Breakup -->
          <div class="card overflow-hidden">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-8">
                  <h5 class="card-title mb-9 fw-semibold">Plan Actual: {{request.user.profile.suscripcion.plan.nombre}}</h5>
                  <h4 class="fw-semibold mb-3">$ {{request.user.profile.suscripcion.plan.price}}</h4>
                  <div class="d-flex align-items-center mb-3">
                    <span class="me-1 rounded-circle bg-light-success round-20 d-flex align-items-center justify-content-center">
                      <i class="ti ti-help text-success"></i>
                    </span>
                    <p class="text-dark me-1 fs-3 mb-0">[[cantidad_de_mensajes]]/∞</p>
                    <p class="fs-3 mb-0">Mensajes</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="d-flex justify-content-center">
                    <div id="breakup"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-12 col-md-6 col-sm-12">
          <!-- Monthly Earnings -->
          <div class="card">
            <div class="card-body">
              <div class="row alig n-items-start">
                <div class="col-8">
                  <h5 class="card-title mb-9 fw-semibold"> Campañas del mes </h5>
                  <h4 class="fw-semibold mb-3">$ 0</h4>
                  <div class="d-flex align-items-center pb-1">
                    <span class="me-2 rounded-circle bg-light-danger round-20 d-flex align-items-center justify-content-center">
                      <i class="ti ti-arrow-down-right text-info"></i>
                    </span>
                    <p class="text-dark me-1 fs-3 mb-0"></p>
                    <p class="fs-3 mb-0">No hay capañas este mes</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="d-flex justify-content-end">
                    <div class="text-white bg-secondary rounded-circle p-6 d-flex align-items-center justify-content-center">
                      <i class="ti ti-currency-dollar fs-6"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="earning"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--  Row 3 -->
  <div class="row d-none">
    <!-- Weekly Stats -->
    <div class="col-lg-4 d-flex align-items-strech ">
      <div class="card w-100">
        <div class="card-body">
          <h5 class="card-title fw-semibold">Estadísticas de Mensajes</h5>
          <p class="card-subtitle mb-0">Estado de Mensajes</p>
          <div id="stats" class="my-4"></div>
          <div class="position-relative">
            <div class="d-flex align-items-center justify-content-between mb-7">
              <div class="d-flex">
                <div class="p-6 bg-light-primary rounded me-6 d-flex align-items-center justify-content-center">
                  <i class="ti ti-grid-dots text-primary fs-6"></i>
                </div>
                <div>
                  <h6 class="mb-1 fs-4 fw-semibold">Total Mensajes</h6>
                  <p class="fs-3 mb-0">Mensajes recibidos</p>
                </div>
              </div>
              <div class="bg-light-primary badge">
                <p class="fs-3 text-primary fw-semibold mb-0">[[cantidad_de_mensajes]]</p>
              </div>
            </div>
            <div class="d-flex align-items-center justify-content-between mb-7">
              <div class="d-flex">
                <div class="p-6 bg-light-success rounded me-6 d-flex align-items-center justify-content-center">
                  <i class="ti ti-grid-dots text-success fs-6"></i>
                </div>
                <div>
                  <h6 class="mb-1 fs-4 fw-semibold">Mensajes Atendidos</h6>
                  <p class="fs-3 mb-0">Mensajes atendidos por el Bot</p>
                </div>
              </div>
              <div class="bg-light-success badge">
                <p class="fs-3 text-success fw-semibold mb-0">[[cantidad_de_mensajes_text]]</p>
              </div>
            </div>
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex">
                <div class="p-6 bg-light-danger rounded me-6 d-flex align-items-center justify-content-center">
                  <i class="ti ti-grid-dots text-danger fs-6"></i>
                </div>
                <div>
                  <h6 class="mb-1 fs-4 fw-semibold">Mensajes Derivados</h6>
                  <p class="fs-3 mb-0">Mensajes derivados a un Ejecutivo</p>
                </div>
              </div>
              <div class="bg-light-warning badge">
                <p class="fs-3 text-warning fw-semibold mb-0">[[cantidad_de_mensajes_whatsapp]]</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Top Performers -->
    <div class="col-lg-8 d-flex align-items-strech">
      <div class="card w-100">
        <div class="card-body">
          <div class="d-sm-flex d-block align-items-center justify-content-between mb-7">
            <div class="mb-3 mb-sm-0">
              <h5 class="card-title fw-semibold">Ejecutivos Activos</h5>
              <p class="card-subtitle mb-0">Mejores ejecutivos</p>
            </div>
            <div>
              <select class="form-select">
                <option value="1">Septiembre 2023</option>
                <option value="2">Agosto 2023</option>
                <option value="3">Julio 2023</option>
                <option value="4">Junio 2023</option>
              </select>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table align-middle text-nowrap mb-0">
              <thead>
                <tr class="text-muted fw-semibold">
                  <th scope="col" class="ps-0">Nombre</th>
                  <th scope="col">Email</th>
                  <th scope="col">Conversaciones</th>
                  <th scope="col">Calificación</th>
                </tr>
              </thead>
              <tbody class="border-top">
                <tr v-for="ejecutivo in ejecutivos">
                  <td class="ps-0">
                    <div class="d-flex align-items-center">
                      <div class="me-2 pe-1">
                        <img src="{% static 'images/profile/user-1.jpg' %}" class="rounded-circle" width="40" height="40" alt="" />
                      </div>
                      <div>
                        <h6 class="fw-semibold mb-1">[[ejecutivo.nombre]] [[ejecutivo.last_name]]</h6>
                        <p class="fs-2 mb-0 text-muted">[[ejecutivo.user_type]]</p>
                      </div>
                    </div>
                  </td>
                  <td>
                    <p class="mb-0 fs-3">[[ejecutivo.username]]</p>
                  </td>
                  <td>
                    <p class="fs-3 text-dark mb-0">0</p>
                  </td>
                  <td>
                    <span class="badge fw-semibold py-1 w-85 bg-light-primary text-primary">Excelente</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <!--  Row 1 -->

{% endblock content %}

{% block js %}
<script src="{% static chat.js %}"></script>
  <!--  current page js files -->
  <script src="{% static 'libs/owl.carousel/dist/owl.carousel.min.js' %}"></script>
  <script src="{% static 'libs/apexcharts/dist/apexcharts.min.js' %}"></script>
  <!-- <script src="{% static 'js/dashboard.js' %}"></script> -->


<script>
  var app = new Vue({
      el: '#app',
      delimiters: ['[[', ']]'],
      data: {
        cantidad_de_mensajes: 0,
        cantidad_de_mensajes_whatsapp: 0,
        cantidad_de_mensajes_text: 0,
        llaves: null,
        valores: null,
        ejecutivos: [],
        fecha_select: "{{meses.0}}",
      },
      mounted() {
        this.GetDashboardData();
      },
      methods: {
          GetDashboardData() {
            let body = {
              "fecha_select": this.fecha_select
            }
            axios.post("/api/internal/get/dashboard/", body, {
                xsrfCookieName: 'csrftoken',
                xsrfHeaderName: 'X-CSRFTOKEN',
            }).then((response) => {
              this.cantidad_de_mensajes = response.data["cantidad_de_mensajes"]
              this.cantidad_de_mensajes_whatsapp = response.data["cantidad_de_mensajes_whatsapp"]
              this.cantidad_de_mensajes_text = response.data["cantidad_de_mensajes_text"]
              this.llaves = response.data["grafico_dias_llaves"]
              this.valores = response.data["grafico_dias_valores"]
              this.ejecutivos = response.data["ejecutivos"]
              var chart = {
                series: [
                  {
                    name: "Cantidad de conversaciones",
                    data: this.valores,
                  },
                  
                ],
                chart: {
                  toolbar: {
                    show: false,
                  },
                  type: "bar",
                  fontFamily: "Plus Jakarta Sans', sans-serif",
                  foreColor: "#adb0bb",
                  height: 320,
                  stacked: true,
                },
                colors: ["var(--bs-secondary)"],
                plotOptions: {
                  bar: {
                    horizontal: false,
                    barHeight: "60%",
                    columnWidth: "20%",
                    borderRadius: [6],
                    borderRadiusApplication: 'end',
                    borderRadiusWhenStacked: 'all'
                  },
                },
                dataLabels: {
                  enabled: false,
                },
                legend: {
                  show: false,
                },
                grid: {
                  borderColor: "rgba(0,0,0,0.1)",
                  strokeDashArray: 3,
                  xaxis: {
                    lines: {
                      show: false,
                    },
                  },
                },
                yaxis: {
                  min: -5,
                  max: 5,
                  title: {
                    // text: 'Age',
                  },
                },
                xaxis: {
                  axisBorder: {
                    show: false,
                  },
                  categories: this.llaves,

                },
                yaxis: {
                  tickAmount: 4,
                },
                tooltip: {
                  theme: "dark",
                },
              };

              var chart = new ApexCharts(document.querySelector("#chart"), chart);
              chart.render();

              var breakup = {
                color: "#adb5bd",
                series: [38, 40, 25],
                labels: ["2022", "2021", "2020"],
                chart: {
                  width: 180,
                  type: "donut",
                  fontFamily: "Plus Jakarta Sans', sans-serif",
                  foreColor: "#adb0bb",
                },
                plotOptions: {
                  pie: {
                    startAngle: 0,
                    endAngle: 360,
                    donut: {
                      size: '75%',
                    },
                  },
                },
                stroke: {
                  show: false,
                },

                dataLabels: {
                  enabled: false,
                },

                legend: {
                  show: false,
                },
                colors: ["var(--bs-primary)", "#ecf2ff", "#F9F9FD"],

                responsive: [
                  {
                    breakpoint: 991,
                    options: {
                      chart: {
                        width: 120,
                      },
                    },
                  },
                ],
                tooltip: {
                  theme: "dark",
                  fillSeriesColor: false,
                },
              };

              var chart = new ApexCharts(document.querySelector("#breakup"), breakup);
              chart.render();

              var earning = {
                chart: {
                  id: "sparkline3",
                  type: "area",
                  height: 60,
                  sparkline: {
                    enabled: true,
                  },
                  group: "sparklines",
                  fontFamily: "Plus Jakarta Sans', sans-serif",
                  foreColor: "#adb0bb",
                },
                series: [
                  {
                    name: "Earnings",
                    color: "var(--bs-secondary)",
                    data: [25, 66, 20, 40, 12, 58, 20],
                  },
                ],
                stroke: {
                  curve: "smooth",
                  width: 2,
                },
                fill: {
                  type: "gradient",
                  gradient: {
                    shadeIntensity: 0,
                    inverseColors: false,
                    opacityFrom: 0.15,
                    opacityTo: 0,
                    stops: [20, 180],
                  },
                  opacity:0.5
                },


                markers: {
                  size: 0,
                },
                tooltip: {
                  theme: "dark",
                  fixed: {
                    enabled: true,
                    position: "right",
                  },
                  x: {
                    show: false,
                  },
                },
              };
              new ApexCharts(document.querySelector("#earning"), earning).render();


            })
          },
      },
  })
</script>

{% endblock js %}
